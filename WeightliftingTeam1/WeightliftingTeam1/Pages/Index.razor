@page "/"
@using WeightliftingTeam1.Components
@using WeightliftingTeam1.Data
@using WeightliftingTeam1.TestModel
@inject AthleteResultService athleteResultService
@*<h1>Hello, world!</h1>

    Welcome to your new app.

    <SurveyPrompt Title="How is Blazor working for you?" />*@

<AuthorizeView>
    <Authorized>
        <div class="text-section">
            hi admin
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="text-section">
            The site is dedicated to weightlifting results
        </div>
    </NotAuthorized>
</AuthorizeView>

<div class="container-fluid min-vh-70">

    <div class="row align-items-start">
        <div class="col-md-3 order-md-12  my-col">
            <select @onchange="ChangePanelTypeEvent" class="custom-select mb-1">
                <option value="@MyPanelType.Athletes">@MyPanelType.Athletes</option>
                <option value="@MyPanelType.Attempts">@MyPanelType.Attempts</option>
            </select>
            <AggregationPanel PanelType="PanelType" OnSearchClick="ChangeResultForGrid"></AggregationPanel>
        </div>
        @switch (PanelType)
        {
            case MyPanelType.Athletes:
                <div class="col-md-9 my-col ">
                    <MyTelerikGrid AthleteResults="AthleteResults"></MyTelerikGrid>
                </div>
                break;
            case MyPanelType.Attempts:
                <div class="col-md-9 my-col ">
                    <MyTelerikGrid Attempts="Attempts"></MyTelerikGrid>
                </div>
                break;
        }
    </div>
</div>

@code{

    public List<AthleteResult> AthleteResults { get; set; }
    public List<Attempt> Attempts { get; set; }

    public MyPanelType PanelType { get; set; }

    protected override async Task OnInitializedAsync()
    {
        PanelType = MyPanelType.Athletes;
        AthleteResults = await Task.Run(() => athleteResultService.GetAthleteResults());
    }

    public async Task ChangePanelTypeEvent(ChangeEventArgs e)
    {
        PanelType = (MyPanelType)Enum.Parse(typeof(MyPanelType), e.Value.ToString(), true);
        switch (PanelType)
        {
            case MyPanelType.Athletes:
                AthleteResults = await Task.Run(() => athleteResultService.GetAthleteResults());
                break;
            case MyPanelType.Attempts:
                Attempts = null;
                break;
        }
    }

    public void ChangeResultForGrid(AggregationPanelInput panelInput)
    {
        //
        //AthleteResults = athleteResultService.GetSearchResults(panelInput, PanelType)
        Console.WriteLine(panelInput.WeightCategory);
        Console.WriteLine(PanelType);
    }
}